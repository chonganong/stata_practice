---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Chong An\Documents\GitHub\stata_practice\build_dataset\temp/02_clean.log
  log type:  text
 opened on:  10 Jul 2017, 12:04:43

. 
. /********************** Section 2: Remove unwanted variables *************************/
. 
. use "`input_dir'\master_list.dta", clear

. keep competition_month competition_year home_city home_section home_state points rank

. 
. /********************** Section 3: Clean competition month ******************************/
. 
. //Not sure what to clean here since it already looks clean
. 
. /********************** Section 3: Generate home state factor variable ******************************/
. 
. replace home_state="GU" if home_city=="Guam"
(1 real change made)

. replace home_state=upper(home_state)
(57 real changes made)

. replace home_state="Foreign" if length(home_state)!=2
(84 real changes made)

. // tab and scroll through to catch irregularities
. replace home_state="Foreign" if home_state=="AB" | home_state=="BC" | home_state=="CZ" | home_state=="ON" | home_state=="PQ" | 
> home_state=="QC" | home_state=="ZH"
(142 real changes made)

. replace home_state="Territory" if home_state=="AS" | home_state=="GU" | home_state=="MP" | home_state=="PR" | home_state=="UM" 
> | home_state=="VI"
(1503 real changes made)

. encode home_state, gen(home_state_factor) label(statelbl)

. drop home_state

.  
. /********************** Section 4: Generate hill indicator variable ******************************/
. 
. gen hill_indicator=0

. replace hill_indicator=1 if regexm(home_city, "Hill")==1 | (regexm(home_city, "hill")==1 & home_city!="Chillicothe")
(1057 real changes made)

. // regexm can capture Hill, hill, etc. more direct
. 
. /********************** Section 5: Generate home state mean points variable ******************************/
. 
. egen home_state_mean=mean(points), by(home_state_factor)

. 
. /********************** Section 6: Generate section count variable ******************************/
. 
. encode home_section, gen(home_section_factor)

. egen section_count=count(home_section_factor), by(home_section_factor competition_year)

. drop home_section_factor

. // best practice to have just one version per variable so all changes get tracked
. 
. ********
. * Save *
. ********
. 
. cd "`output_dir'"
C:\Users\Chong An\Documents\GitHub\stata_practice\build_dataset\output

. save "`output_dir'\clean.dta", replace
(note: file C:\Users\Chong An\Documents\GitHub\stata_practice\build_dataset\output\clean.dta not found)
file C:\Users\Chong An\Documents\GitHub\stata_practice\build_dataset\output\clean.dta saved

. // combine the cd and saving into one line by specifying file path
. 
. log close
      name:  <unnamed>
       log:  C:\Users\Chong An\Documents\GitHub\stata_practice\build_dataset\temp/02_clean.log
  log type:  text
 closed on:  10 Jul 2017, 12:04:44
---------------------------------------------------------------------------------------------------------------------------------
